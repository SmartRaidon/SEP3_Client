@page "/create-match"
@using System.Security.Claims

<AuthorizeView>
    <Authorized Context="authContext">
        <div class="d-flex justify-content-center mt-4">
            <div class="text-center">
                <h3>Invite code</h3>
                <input type="text" id="inviteCode" class="form-control mx-auto mt-1 text-center" style="width: 300px;" value="@InviteCode" readonly/>
                <button class="btn btn-outline-secondary mt-3" @onclick="CopyInviteCode">Copy</button>
                <h6 class="mt-3">Waiting for opponent ...</h6>
            </div>
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private string InviteCode = "#PLACEHOLDER_CODE"; // replace with your dynamic code
    [CascadingParameter] public Task<AuthenticationState> State { get; set; }
    [Inject] private IJSRuntime JS { get; set; }
    
    private async Task CopyInviteCode()
    {
        await JS.InvokeVoidAsync("navigator.clipboard.writeText", InviteCode);
    }

    protected override async Task OnInitializedAsync()
    {
        AuthenticationState authenticationState = await State;
        ClaimsPrincipal principal = authenticationState.User;
        if (principal.Identity is null || !principal.Identity.IsAuthenticated)
        {
            // the user is not logged in
            return;
        }
        string? username = principal.Identity.Name;
        IEnumerable<Claim> claims = principal.Claims;
        string userIdAsString = claims.Single(c => c.Type == ClaimTypes.NameIdentifier).Value;
        Console.WriteLine("[ CREATE MATCH ] Generating invite code (PLACEHOLDER)");
    }
}